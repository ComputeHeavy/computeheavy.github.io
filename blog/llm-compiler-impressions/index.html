<html>
    <head>
        <meta name="twitter:site" content="@TACIXAT" />
        <meta name="twitter:title" content="LLM Compiler - First Impressions" />
        <meta name="twitter:description" content="LLM Compiler usage and evaluation." />
        <meta name="twitter:image" content="https://computeheavy.com/blog/assets/llm-compiler-fi.webp" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
        <link rel="stylesheet" href="/site.css">
    </head>

    <body>
        <h1>LLM Compiler - First Impressions</h1>

        <p>It is an official opinion at Compute Heavy Industries that machine language research, as opposed to natural language research, is the most viable path toward programmable general intelligence. That being said, we were very excited about the release of Meta AI's LLM Compiler.</p>

        <p>We are in a unique position to dive into this model, with a deep background in application security and more recent work in around the automation of code generation models.</p> 

        <p>That being said, this is a cursory review with a small sample size.</p>

        <div>
            <h2>LLM Compiler</h2>

            <p>Meta's LLM Compiler is a llama-architecture model trained on LLVM intermediate representation (IR) and (primarily) Linux x86-64 assembly code. If you are unfamiliar with LLVM, it is a compiler framework consisting of frontends that convert the source code of different programming languages (e.g. C, C++, Rust, etc.) to LLVM IR, and backends that convert LLVM IR to different assembly architectures (e.g. x86-64, ARM, WASM, etc.).</p>

            <p>LLVM, being a compiler framework, allows you to write passes over the LLVM IR to analyze and optimize it. This is a pretty attractive concept for security researchers. If you can find bugs via analyzing the LLVM, you get many languages for free. Further, there is research around lifting assembly code into LLVM IR under the same premise. If you can lift different targets into LLVM IR, you only need to write your analyses for a single target and you get many architectures for free.</p>

            <p>Back to the LLM Compiler model. Its primary focus is on taking LLVM IR and outputting LLVM IR or x86-64 assembly given some optimization passes as parameters. Additionally, Meta made a finetune for lifting code from assembly to LLVM IR (very cool!). Our work highlighted in this post focuses solely on the translation of LLVM IR to assembly.</p>

            <p>The last thing to note is that the model has a context window of 16k tokens.</p>
        </div>

        <div>
            <h2>Setup</h2>

            <p>Since LLM Compiler targets x86-64 Linux assembly, we used LLVM in Windows Subsytem for Linux (WSL). Specifically, we were using <a href="https://apt.llvm.org/">LLMV 18</a>.</p>

            <p>To run the model we used <a href="https://github.com/ggerganov/llama.cpp">llama.cpp</a>. We initially tried with HuggingFace but it did not work, likely because Python is bad. We converted the models for llama.cpp and the model ran without issue.</p>

            <p>There are a few releases of the model. The <span>*-ftd</span> models are the fine tunes for flag tuning and lifting assembly to LLVM IR. We ran the 7b base model.</p>

            <p>For the hardware, we used a RTX 3090. The 7b model ran performantly at ~40 tok/s. It appeared that the 13b model exceeded 24 GB of GPU memory during inference.</p>
        </div>

        <div>
            <h2>The Prompts</h2>

            <p>As mentioned above, there are four prompts provided in the demo code that was released with the model.</p>

            <p>The first translates from LLVM IR to LLVM IR given some optimization passes.</p>

            <pre>
[INST] Give the LLVM-IR for the following code when optimized using opt -p '{passes}':

&lt;code&gt;{ir}&lt;/code&gt;

The input code has instruction count {ir_count} and binary size {bin_size} bytes. [/INST]
            </pre>

            <p>The second translates from LLVM IR to ASM given some optimization passes. This was the prompt we focused on for this evaluation.</p> 

            <pre>
[INST] Give the assembly for the following code when optimized using opt -p '{passes}':

&lt;code&gt;{ir}&lt;/code&gt;

The input code has instruction count {ir_count} and binary size {bin_size} bytes. [/INST]
            </pre>   

            <p>The third is about code optimizations. We did not test this so we cannot speak to whether it provides a list of optimization passes or actually describes what they do to the LLVM IR.</p>

            <pre>
[INST] Tell me how to optimize this LLVM-IR for object file size:

&lt;code&gt;{ir}&lt;/code&gt; [/INST]
            </pre>

            <p>The fourth is for lifting assembly to LLVM IR. We also did not run this functionality.</p>

            <pre>
[INST] Disassemble this code to LLVM-IR:

&lt;code&gt;{asm}&lt;/code&gt; [/INST]
            </pre>

        </div>

        <div>
            <h2>Our Test Program</h2>

            <p>Our evaluation program parses a diff of a Git LFS pointer file in order to extract the old and new object hashes. The goal in writing this program was to have some simple parsing logic that would exercise a variety low level instructions. Additionally, we wanted the program to be self-contained so we would not have to fix up APIs or debug inlined library functions (e.g. <span>strcmp</span>).</p>

            <p>Glancing through the paper we noticed that the model was trained on a maximum function size of 8k tokens to give 8k for the prompt and 8k for the output. We initially had everything in the <span>parse_diff</span> function and upon evaluation, this function exceeded 8k tokens. We started breaking out functionality until our four test functions were all under 8k tokens.</p>

            <pre>
<div style="white-space:pre;font-family:Consolas;color:#d8dee9;-moz-tab-size:4;tab-size:4;"><span style="color:#c695c6;">#include</span> <span style="color:#5fb4b4;">&lt;</span><span style="color:#99c794;">stdio.h</span><span style="color:#5fb4b4;">></span><br><span style="color:#c695c6;">#include</span> <span style="color:#5fb4b4;">&lt;</span><span style="color:#99c794;">stdint.h</span><span style="color:#5fb4b4;">></span><br><span style="color:#c695c6;">#include</span> <span style="color:#5fb4b4;">&lt;</span><span style="color:#99c794;">stdbool.h</span><span style="color:#5fb4b4;">></span><br><span style="color:#c695c6;">#include</span> <span style="color:#5fb4b4;">&lt;</span><span style="color:#99c794;">string.h</span><span style="color:#5fb4b4;">></span><br><br><span style="color:#6699cc;font-style:italic;">size_t</span> <span style="color:#5fb4b4;">consume_line</span><span style="color:#ffffff;">(</span><span style="color:#c695c6;font-style:italic;">char</span> <span style="color:#f97b58;">*</span><span style="color:#f9ae58;">in_buf</span><span style="color:#a6acb9;">,</span> <span style="color:#6699cc;font-style:italic;">size_t</span> <span style="color:#f9ae58;">in_size</span><span style="color:#a6acb9;">,</span> <span style="color:#6699cc;font-style:italic;">size_t</span> <span style="color:#f9ae58;">idx</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>    <span style="color:#c695c6;">while</span> <span style="color:#ffffff;">(</span>idx <span style="color:#f97b58;">&lt;</span> in_size <span style="color:#f97b58;">&amp;&amp;</span> in_buf<span style="color:#ffffff;">[</span>idx<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">!=</span> <span style="color:#5fb4b4;">'</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">'</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        idx<span style="color:#f97b58;">++</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br>    idx<span style="color:#f97b58;">++</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;">return</span> idx<span style="color:#a6acb9;">;</span><br><span style="color:#ffffff;">}</span><br><br><span style="color:#c695c6;font-style:italic;">bool</span> <span style="color:#5fb4b4;">copy_64_hex</span><span style="color:#ffffff;">(</span><span style="color:#c695c6;font-style:italic;">char</span> <span style="color:#f97b58;">*</span><span style="color:#f9ae58;">in_buf</span><span style="color:#a6acb9;">,</span> <span style="color:#c695c6;font-style:italic;">char</span> <span style="color:#f97b58;">*</span><span style="color:#f9ae58;">out_buf</span><span style="color:#a6acb9;">,</span> <span style="color:#6699cc;font-style:italic;">size_t</span> <span style="color:#f9ae58;">idx</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>    <span style="color:#c695c6;">for</span> <span style="color:#ffffff;">(</span><span style="color:#c695c6;font-style:italic;">int</span> i <span style="color:#f97b58;">=</span> <span style="color:#f9ae58;">0</span><span style="color:#a6acb9;">;</span> i <span style="color:#f97b58;">&lt;</span> <span style="color:#f9ae58;">64</span><span style="color:#a6acb9;">;</span> i<span style="color:#f97b58;">++</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">!</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#ffffff;">[</span>idx<span style="color:#f97b58;">+</span>i<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">>=</span> <span style="color:#f9ae58;">0x</span><span style="color:#f9ae58;">30</span> <span style="color:#f97b58;">&amp;&amp;</span> in_buf<span style="color:#ffffff;">[</span>idx<span style="color:#f97b58;">+</span>i<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">&lt;=</span> <span style="color:#f9ae58;">0x</span><span style="color:#f9ae58;">39</span> <span style="color:#f97b58;">||</span> <br>            in_buf<span style="color:#ffffff;">[</span>idx<span style="color:#f97b58;">+</span>i<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">>=</span> <span style="color:#f9ae58;">0x</span><span style="color:#f9ae58;">61</span> <span style="color:#f97b58;">&amp;&amp;</span> in_buf<span style="color:#ffffff;">[</span>idx<span style="color:#f97b58;">+</span>i<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">&lt;=</span> <span style="color:#f9ae58;">0x</span><span style="color:#f9ae58;">66</span> <span style="color:#f97b58;">||</span> <br>            in_buf<span style="color:#ffffff;">[</span>idx<span style="color:#f97b58;">+</span>i<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">>=</span> <span style="color:#f9ae58;">0x</span><span style="color:#f9ae58;">41</span> <span style="color:#f97b58;">&amp;&amp;</span> in_buf<span style="color:#ffffff;">[</span>idx<span style="color:#f97b58;">+</span>i<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">&lt;=</span> <span style="color:#f9ae58;">0x</span><span style="color:#f9ae58;">46</span><span style="color:#ffffff;">)</span><span style="color:#ffffff;">)</span> <br>        <span style="color:#ffffff;">{</span><br>            <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>        <span style="color:#ffffff;">}</span><br><br>        out_buf<span style="color:#ffffff;">[</span>i<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">=</span> in_buf<span style="color:#ffffff;">[</span>idx<span style="color:#f97b58;">+</span>i<span style="color:#ffffff;">]</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">true</span><span style="color:#a6acb9;">;</span><br><span style="color:#ffffff;">}</span><br><br><span style="color:#c695c6;font-style:italic;">bool</span> <span style="color:#5fb4b4;">validate</span><span style="color:#ffffff;">(</span><span style="color:#c695c6;font-style:italic;">char</span> <span style="color:#f97b58;">*</span><span style="color:#f9ae58;">in_buf</span><span style="color:#a6acb9;">,</span> <span style="color:#6699cc;font-style:italic;">size_t</span> <span style="color:#f9ae58;">in_size</span><span style="color:#a6acb9;">,</span> <span style="color:#6699cc;font-style:italic;">size_t</span> <span style="color:#f97b58;">*</span><span style="color:#f9ae58;">idx</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>    <span style="color:#a6acb9;">//</span><span style="color:#a6acb9;"> </span><span style="color:#a6acb9;">Check </span><span style="color:#a6acb9;">starts </span><span style="color:#a6acb9;">with </span><span style="color:#a6acb9;">"diff".</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span><span style="color:#ffffff;">(</span><span style="color:#6699cc;font-style:italic;">uint32_t</span> <span style="color:#f97b58;">*</span><span style="color:#ffffff;">)</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#f97b58;">+</span><span style="color:#f97b58;">*</span>idx<span style="color:#ffffff;">)</span> <span style="color:#f97b58;">!=</span> <span style="color:#f9ae58;">0x</span><span style="color:#f9ae58;">66666964</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#f97b58;">*</span>idx <span style="color:#f97b58;">+=</span> <span style="color:#f9ae58;">4</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#f97b58;">*</span>idx <span style="color:#f97b58;">=</span> <span style="color:#6699cc;">consume_line</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#a6acb9;">,</span> in_size<span style="color:#a6acb9;">,</span> <span style="color:#f97b58;">*</span>idx<span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span>idx <span style="color:#f97b58;">>=</span> in_size<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#f97b58;">*</span>idx <span style="color:#f97b58;">=</span> <span style="color:#6699cc;">consume_line</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#a6acb9;">,</span> in_size<span style="color:#a6acb9;">,</span> <span style="color:#f97b58;">*</span>idx<span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span>idx <span style="color:#f97b58;">>=</span> in_size<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#a6acb9;">//</span><span style="color:#a6acb9;"> </span><span style="color:#a6acb9;">Check </span><span style="color:#a6acb9;">line </span><span style="color:#a6acb9;">starts </span><span style="color:#a6acb9;">with </span><span style="color:#a6acb9;">"--- </span><span style="color:#a6acb9;">".</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_size <span style="color:#f97b58;">-</span> <span style="color:#f97b58;">*</span>idx <span style="color:#f97b58;">&lt;</span> <span style="color:#f9ae58;">4</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_buf<span style="color:#ffffff;">[</span><span style="color:#f97b58;">*</span>idx<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">!=</span> <span style="color:#5fb4b4;">'</span><span style="color:#99c794;">-</span><span style="color:#5fb4b4;">'</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span>idx<span style="color:#ffffff;">)</span><span style="color:#f97b58;">++</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_buf<span style="color:#ffffff;">[</span><span style="color:#f97b58;">*</span>idx<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">!=</span> <span style="color:#5fb4b4;">'</span><span style="color:#99c794;">-</span><span style="color:#5fb4b4;">'</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span>idx<span style="color:#ffffff;">)</span><span style="color:#f97b58;">++</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_buf<span style="color:#ffffff;">[</span><span style="color:#f97b58;">*</span>idx<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">!=</span> <span style="color:#5fb4b4;">'</span><span style="color:#99c794;">-</span><span style="color:#5fb4b4;">'</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span>idx<span style="color:#ffffff;">)</span><span style="color:#f97b58;">++</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_buf<span style="color:#ffffff;">[</span><span style="color:#f97b58;">*</span>idx<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">!=</span> <span style="color:#5fb4b4;">'</span><span style="color:#99c794;"> </span><span style="color:#5fb4b4;">'</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span>idx<span style="color:#ffffff;">)</span><span style="color:#f97b58;">++</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#f97b58;">*</span>idx <span style="color:#f97b58;">=</span> <span style="color:#6699cc;">consume_line</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#a6acb9;">,</span> in_size<span style="color:#a6acb9;">,</span> <span style="color:#f97b58;">*</span>idx<span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span>idx <span style="color:#f97b58;">>=</span> in_size<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#a6acb9;">//</span><span style="color:#a6acb9;"> </span><span style="color:#a6acb9;">Check </span><span style="color:#a6acb9;">line </span><span style="color:#a6acb9;">starts </span><span style="color:#a6acb9;">with </span><span style="color:#a6acb9;">"+++ </span><span style="color:#a6acb9;">".</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_size <span style="color:#f97b58;">-</span> <span style="color:#f97b58;">*</span>idx <span style="color:#f97b58;">&lt;</span> <span style="color:#f9ae58;">4</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#c695c6;font-style:italic;">char</span> <span style="color:#f97b58;">*</span>check <span style="color:#f97b58;">=</span> <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">+++ </span><span style="color:#5fb4b4;">"</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;">for</span> <span style="color:#ffffff;">(</span><span style="color:#c695c6;font-style:italic;">int</span> i <span style="color:#f97b58;">=</span> <span style="color:#f9ae58;">0</span><span style="color:#a6acb9;">;</span> i <span style="color:#f97b58;">&lt;</span> <span style="color:#f9ae58;">4</span><span style="color:#a6acb9;">;</span> i<span style="color:#f97b58;">++</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_buf<span style="color:#ffffff;">[</span><span style="color:#f97b58;">*</span>idx<span style="color:#f97b58;">+</span>i<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">!=</span> check<span style="color:#ffffff;">[</span>i<span style="color:#ffffff;">]</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>            <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>        <span style="color:#ffffff;">}</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#f97b58;">*</span>idx <span style="color:#f97b58;">+=</span> <span style="color:#f9ae58;">4</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">true</span><span style="color:#a6acb9;">;</span><br><span style="color:#ffffff;">}</span><br><br><span style="color:#c695c6;font-style:italic;">bool</span> <span style="color:#5fb4b4;">parse_diff</span><span style="color:#ffffff;">(</span><span style="color:#c695c6;font-style:italic;">char</span> <span style="color:#f97b58;">*</span><span style="color:#f9ae58;">in_buf</span><span style="color:#a6acb9;">,</span> <span style="color:#6699cc;font-style:italic;">size_t</span> <span style="color:#f9ae58;">in_size</span><span style="color:#a6acb9;">,</span> <span style="color:#c695c6;font-style:italic;">char</span> <span style="color:#f97b58;">*</span><span style="color:#f9ae58;">out_buf</span><span style="color:#a6acb9;">,</span> <span style="color:#6699cc;font-style:italic;">size_t</span> <span style="color:#f9ae58;">out_size</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_size <span style="color:#f97b58;">&lt;</span> <span style="color:#f9ae58;">4</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>out_size <span style="color:#f97b58;">&lt;</span> <span style="color:#f9ae58;">128</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#6699cc;font-style:italic;">size_t</span> idx <span style="color:#f97b58;">=</span> <span style="color:#f9ae58;">0</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;font-style:italic;">bool</span> ok <span style="color:#f97b58;">=</span> <span style="color:#6699cc;">validate</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#a6acb9;">,</span> in_size<span style="color:#a6acb9;">,</span> <span style="color:#f97b58;">&amp;</span>idx<span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">!</span>ok<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    idx <span style="color:#f97b58;">=</span> <span style="color:#6699cc;">consume_line</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#a6acb9;">,</span> in_size<span style="color:#a6acb9;">,</span> idx<span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>idx <span style="color:#f97b58;">>=</span> in_size<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#a6acb9;">//</span><span style="color:#a6acb9;"> </span><span style="color:#a6acb9;">Check </span><span style="color:#a6acb9;">line </span><span style="color:#a6acb9;">matches </span><span style="color:#a6acb9;">"@@ </span><span style="color:#a6acb9;">-1,3 </span><span style="color:#a6acb9;">+1,3 </span><span style="color:#a6acb9;">@@\n".</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_size <span style="color:#f97b58;">-</span> idx <span style="color:#f97b58;">&lt;</span> <span style="color:#f9ae58;">16</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span><span style="color:#ffffff;">(</span><span style="color:#6699cc;font-style:italic;">uint64_t</span> <span style="color:#f97b58;">*</span><span style="color:#ffffff;">)</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#f97b58;">+</span>idx<span style="color:#ffffff;">)</span> <span style="color:#f97b58;">!=</span> <span style="color:#f9ae58;">0x</span><span style="color:#f9ae58;">20332c312d204040</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    idx <span style="color:#f97b58;">+=</span> <span style="color:#f9ae58;">8</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span><span style="color:#ffffff;">(</span><span style="color:#6699cc;font-style:italic;">uint64_t</span> <span style="color:#f97b58;">*</span><span style="color:#ffffff;">)</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#f97b58;">+</span>idx<span style="color:#ffffff;">)</span> <span style="color:#f97b58;">!=</span> <span style="color:#f9ae58;">0x</span><span style="color:#f9ae58;">a404020332c312b</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    idx <span style="color:#f97b58;">+=</span> <span style="color:#f9ae58;">8</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#a6acb9;">//</span><span style="color:#a6acb9;"> </span><span style="color:#a6acb9;">Check </span><span style="color:#a6acb9;">version </span><span style="color:#a6acb9;">line.</span><br>    <span style="color:#6699cc;font-style:italic;">size_t</span> check_size <span style="color:#f97b58;">=</span> <span style="color:#f9ae58;">44</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;font-style:italic;">char</span> <span style="color:#f97b58;">*</span>check <span style="color:#f97b58;">=</span> <span style="color:#5fb4b4;">"</span><span style="color:#99c794;"> </span><span style="color:#99c794;">version </span><span style="color:#99c794;">https://git-lfs.github.com</span><span style="color:#99c794;">/</span><span style="color:#99c794;">spec</span><span style="color:#99c794;">/</span><span style="color:#99c794;">v1</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_size <span style="color:#f97b58;">-</span> idx <span style="color:#f97b58;">&lt;</span> check_size<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#c695c6;">for</span> <span style="color:#ffffff;">(</span><span style="color:#c695c6;font-style:italic;">int</span> i <span style="color:#f97b58;">=</span> <span style="color:#f9ae58;">0</span><span style="color:#a6acb9;">;</span> i <span style="color:#f97b58;">&lt;</span> check_size<span style="color:#a6acb9;">;</span> i<span style="color:#f97b58;">++</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_buf<span style="color:#ffffff;">[</span>idx<span style="color:#f97b58;">+</span>i<span style="color:#ffffff;">]</span> <span style="color:#f97b58;">!=</span> check<span style="color:#ffffff;">[</span>i<span style="color:#ffffff;">]</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>            <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>        <span style="color:#ffffff;">}</span><br>    <span style="color:#ffffff;">}</span><br><br>    idx <span style="color:#f97b58;">+=</span> check_size<span style="color:#a6acb9;">;</span><br><br>    <span style="color:#a6acb9;">//</span><span style="color:#a6acb9;"> </span><span style="color:#a6acb9;">Parse </span><span style="color:#a6acb9;">old </span><span style="color:#a6acb9;">hash.</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_size <span style="color:#f97b58;">-</span> idx <span style="color:#f97b58;">&lt;</span> <span style="color:#f9ae58;">76</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#6699cc;font-style:italic;">uint32_t</span> oid_check <span style="color:#f97b58;">=</span> <span style="color:#f9ae58;">0x</span><span style="color:#f9ae58;">64696f2d</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span><span style="color:#ffffff;">(</span><span style="color:#6699cc;font-style:italic;">uint32_t</span> <span style="color:#f97b58;">*</span><span style="color:#ffffff;">)</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#f97b58;">+</span>idx<span style="color:#ffffff;">)</span> <span style="color:#f97b58;">!=</span> oid_check<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    idx <span style="color:#f97b58;">+=</span> <span style="color:#f9ae58;">4</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#6699cc;font-style:italic;">uint64_t</span> sha256_check_u <span style="color:#f97b58;">=</span> <span style="color:#f9ae58;">0x</span><span style="color:#f9ae58;">3a36353261687320</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span><span style="color:#ffffff;">(</span><span style="color:#6699cc;font-style:italic;">uint64_t</span> <span style="color:#f97b58;">*</span><span style="color:#ffffff;">)</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#f97b58;">+</span>idx<span style="color:#ffffff;">)</span> <span style="color:#f97b58;">!=</span> sha256_check_u<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    idx <span style="color:#f97b58;">+=</span> <span style="color:#f9ae58;">8</span><span style="color:#a6acb9;">;</span><br><br>    ok <span style="color:#f97b58;">=</span> <span style="color:#6699cc;">copy_64_hex</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#a6acb9;">,</span> out_buf<span style="color:#a6acb9;">,</span> idx<span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">!</span>ok<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    idx <span style="color:#f97b58;">+=</span> <span style="color:#f9ae58;">64</span><span style="color:#a6acb9;">;</span><br>    idx<span style="color:#f97b58;">++</span><span style="color:#a6acb9;">;</span><br><br>    idx <span style="color:#f97b58;">=</span> <span style="color:#6699cc;">consume_line</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#a6acb9;">,</span> in_size<span style="color:#a6acb9;">,</span> idx<span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>idx <span style="color:#f97b58;">>=</span> in_size<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#a6acb9;">//</span><span style="color:#a6acb9;"> </span><span style="color:#a6acb9;">Parse </span><span style="color:#a6acb9;">new </span><span style="color:#a6acb9;">hash.</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span>in_size <span style="color:#f97b58;">-</span> idx <span style="color:#f97b58;">&lt;</span> <span style="color:#f9ae58;">76</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    oid_check <span style="color:#f97b58;">^=</span> <span style="color:#f9ae58;">0b</span><span style="color:#f9ae58;">110</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span><span style="color:#ffffff;">(</span><span style="color:#6699cc;font-style:italic;">uint32_t</span> <span style="color:#f97b58;">*</span><span style="color:#ffffff;">)</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#f97b58;">+</span>idx<span style="color:#ffffff;">)</span> <span style="color:#f97b58;">!=</span> oid_check<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    idx <span style="color:#f97b58;">+=</span> <span style="color:#f9ae58;">4</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;font-style:italic;">char</span> <span style="color:#f97b58;">*</span>sha256_check_s <span style="color:#f97b58;">=</span> <span style="color:#5fb4b4;">"</span><span style="color:#99c794;"> </span><span style="color:#99c794;">sha256:</span><span style="color:#5fb4b4;">"</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">*</span><span style="color:#ffffff;">(</span><span style="color:#6699cc;font-style:italic;">uint64_t</span> <span style="color:#f97b58;">*</span><span style="color:#ffffff;">)</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#f97b58;">+</span>idx<span style="color:#ffffff;">)</span> <span style="color:#f97b58;">!=</span> <span style="color:#f97b58;">*</span><span style="color:#ffffff;">(</span><span style="color:#6699cc;font-style:italic;">uint64_t</span> <span style="color:#f97b58;">*</span><span style="color:#ffffff;">)</span>sha256_check_s<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    idx <span style="color:#f97b58;">+=</span> <span style="color:#f9ae58;">8</span><span style="color:#a6acb9;">;</span><br><br>    ok <span style="color:#f97b58;">=</span> <span style="color:#6699cc;">copy_64_hex</span><span style="color:#ffffff;">(</span>in_buf<span style="color:#a6acb9;">,</span> out_buf<span style="color:#f97b58;">+</span><span style="color:#f9ae58;">64</span><span style="color:#a6acb9;">,</span> idx<span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">!</span>ok<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">false</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    idx <span style="color:#f97b58;">+=</span> <span style="color:#f9ae58;">64</span><span style="color:#a6acb9;">;</span><br>    idx<span style="color:#f97b58;">++</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;">return</span> <span style="color:#ec5f66;font-style:italic;">true</span><span style="color:#a6acb9;">;</span><br><span style="color:#ffffff;">}</span><br><br><span style="color:#c695c6;font-style:italic;">int</span> <span style="color:#5fb4b4;">main</span><span style="color:#ffffff;">(</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>    <span style="color:#c695c6;font-style:italic;">char</span> <span style="color:#f97b58;">*</span>diff <span style="color:#f97b58;">=</span> <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">diff </span><span style="color:#99c794;">--git </span><span style="color:#99c794;">a</span><span style="color:#99c794;">/</span><span style="color:#99c794;">objects</span><span style="color:#99c794;">/</span><span style="color:#99c794;">AcademicDarkvioletCoqui.jpg </span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">b</span><span style="color:#99c794;">/</span><span style="color:#99c794;">objects</span><span style="color:#99c794;">/</span><span style="color:#99c794;">AcademicDarkvioletCoqui.jpg</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">index </span><span style="color:#99c794;">a1c4d61..bec8408 </span><span style="color:#99c794;">100644</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">--- </span><span style="color:#99c794;">a</span><span style="color:#99c794;">/</span><span style="color:#99c794;">objects</span><span style="color:#99c794;">/</span><span style="color:#99c794;">AcademicDarkvioletCoqui.jpg</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">+++ </span><span style="color:#99c794;">b</span><span style="color:#99c794;">/</span><span style="color:#99c794;">objects</span><span style="color:#99c794;">/</span><span style="color:#99c794;">AcademicDarkvioletCoqui.jpg</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">@@ </span><span style="color:#99c794;">-1,3 </span><span style="color:#99c794;">+1,3 </span><span style="color:#99c794;">@@</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;"> </span><span style="color:#99c794;">version </span><span style="color:#99c794;">https://git-lfs.github.com</span><span style="color:#99c794;">/</span><span style="color:#99c794;">spec</span><span style="color:#99c794;">/</span><span style="color:#99c794;">v1</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">-oid </span><span style="color:#99c794;">sha256:</span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">8751496787dd63ed263ba24afd9cfdec599650af13879735d656af3fd81ccdf5</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">-size </span><span style="color:#99c794;">550008</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">+oid </span><span style="color:#99c794;">sha256:</span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">f356316203a3818c48018990d476395d38d25550619224c35a7416393e520f52</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">+size </span><span style="color:#99c794;">48722</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#a6acb9;">//</span><span style="color:#a6acb9;"> </span><span style="color:#a6acb9;">printf("%s", </span><span style="color:#a6acb9;">diff);</span><br><br>    <span style="color:#c695c6;font-style:italic;">char</span> out_buf<span style="color:#ffffff;">[</span><span style="color:#f9ae58;">129</span><span style="color:#ffffff;">]</span> <span style="color:#f97b58;">=</span> <span style="color:#ffffff;">{</span> <span style="color:#f9ae58;">0</span> <span style="color:#ffffff;">}</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#6699cc;font-style:italic;">size_t</span> out_size <span style="color:#f97b58;">=</span> <span style="color:#f9ae58;">128</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#6699cc;font-style:italic;">size_t</span> diff_size <span style="color:#f97b58;">=</span> <span style="color:#6699cc;font-style:italic;">strlen</span><span style="color:#ffffff;">(</span>diff<span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#c695c6;font-style:italic;">bool</span> ok <span style="color:#f97b58;">=</span> <span style="color:#6699cc;">parse_diff</span><span style="color:#ffffff;">(</span>diff<span style="color:#a6acb9;">,</span> diff_size<span style="color:#a6acb9;">,</span> out_buf<span style="color:#a6acb9;">,</span> out_size<span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#f97b58;">!</span>ok<span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#6699cc;font-style:italic;">printf</span><span style="color:#ffffff;">(</span><span style="color:#5fb4b4;">"</span><span style="color:#99c794;">FALSE</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#f9ae58;">1</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#c695c6;font-style:italic;">char</span> <span style="color:#f97b58;">*</span>check <span style="color:#f97b58;">=</span> <br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">8751496787dd63ed263ba24afd9cfdec599650af13879735d656af3fd81ccdf5</span><span style="color:#5fb4b4;">"</span><br>        <span style="color:#5fb4b4;">"</span><span style="color:#99c794;">f356316203a3818c48018990d476395d38d25550619224c35a7416393e520f52</span><span style="color:#5fb4b4;">"</span><span style="color:#a6acb9;">;</span><br><br>    <span style="color:#c695c6;">if</span> <span style="color:#ffffff;">(</span><span style="color:#6699cc;font-style:italic;">memcmp</span><span style="color:#ffffff;">(</span>out_buf<span style="color:#a6acb9;">,</span> check<span style="color:#a6acb9;">,</span> <span style="color:#f9ae58;">128</span><span style="color:#ffffff;">)</span> <span style="color:#f97b58;">!=</span> <span style="color:#f9ae58;">0</span><span style="color:#ffffff;">)</span> <span style="color:#ffffff;">{</span><br>        <span style="color:#6699cc;font-style:italic;">printf</span><span style="color:#ffffff;">(</span><span style="color:#5fb4b4;">"</span><span style="color:#99c794;">BAD</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br>        <span style="color:#c695c6;">return</span> <span style="color:#f9ae58;">1</span><span style="color:#a6acb9;">;</span><br>    <span style="color:#ffffff;">}</span><br><br>    <span style="color:#6699cc;font-style:italic;">printf</span><span style="color:#ffffff;">(</span><span style="color:#5fb4b4;">"</span><span style="color:#99c794;">OK</span><span style="color:#c695c6;">\n</span><span style="color:#5fb4b4;">"</span><span style="color:#ffffff;">)</span><span style="color:#a6acb9;">;</span><br><span style="color:#ffffff;">}</span></div>
            </pre>
        </div>

        <div>
            <h2>Prompt Parameters</h2>

            <p>You might have noticed above, the prompt for converting LLVM IR to assembly takes a few parameters. The first is a list of optimization passes. We are not so interested in optimization so we just put <span>O0</span> in this field.</p>

            <p>Following this is the IR. To get the IR for a specific function, we first compiled our test program using <span>clang</span>, emitting LLVM IR. The output of this command will be <span>main.ll</span>.</p>

            <pre>clang-18 -S -emit-llvm -Xclang -disable-O0-optnone main.c</pre>

            <p>Additionally, we prevent the <span>optnone</span> decoration from being added to the LLVM IR functions. This decoration prevents optimization passes from running on the code, which will be important in a couple paragraphs when we try to get the instruction count.</p>

            <p>Once we have our <span>main.ll</span> file full of LLVM IR, we need to extract a specific function. Using <span>consume_line</span> as our example, we can extrac that function from the LLVM IR to get an LLVM bitcode (binary representation of the human readable IR) file with that function broken out.</p>

            <pre>llvm-extract-18 --func=consume_line main.ll -o consume_line.bc</pre>

            <p>For our prompt, we now bring the bitcode file to LLVM IR.</p>

            <pre>llvm-dis-18 consume_line.bc</pre>

            <p>Now there are two more parameters in the prompt. The count of instructions in the LLVM IR and the nebulous binary size. To automate getting the instruction count, we can use <span>opt</span> which runs optimization passes over LLVM IR. Specifically, we want to run the <span>instcount</span> pass.</p>

            <pre>opt-18 -stats --passes=instcount -o /dev/null -debug-pass-manager consume_line.bc</pre>

            <p>This little command had us recompiling LLVM all weekend. The first issue is that the <span>instcount</span> pass outputs statistics. It is our understanding that statistic do not get output if you have a <span>release</span> build. Once you've rebuilt to get a <span>debug</span> build and that pass still does not work, you will find that passes do not run if your functions are annotated with <span>optnone</span>, as mentioned above. The way to discover this is with the switch <span>-debug-pass-manager</span>, which will show you that each function is being skipped due to <span>optnone</span>. Once you sort that you will see some nice detailed statistics. Now, maybe you have accidentally switched back to a release build when going from your Windows LLVM build to the LLVM <span>apt</span> distribution. In this case, you will see no statistics, but if you again use the <span>-debug-pass-manager</span> switch you can see a single statistic reporting total instruction count. Exactly what we need!</p>

            <p>The ambiguous binary size. For this one we turn to the LLM Compiler paper.</p>

            <p><i>We use two metrics for code size: the number of IR instructions, and binary size. Binary size is computed by summing the size of the .TEXT and .DATA sections of the IR or assembly after lowering to an object file; we exclude .BSS section from our binary size metric since it does not affect on-disk size.</i></p>

            <p>What they do not mention is that the utility <span>llvm-size</span> can report the different section sizes for you if you assemble the LLVM IR to an object file )<span>.o</span>).</p>

            <pre>llc-18 consume_line.ll -filetype=obj</pre>

            <pre>llvm-size-18 consume_line.o</pre>

            <p>With that, we have all of the parameters needed for a prompt.</p>
        </div>

        <div>
            <h2>Inference</h2>

            <p>Llama.cpp works extremely well so this part is straighforward. You can convert a model from HuggingFace format to GGUF using the <span>convert.py</span> script in the repo. You will want to build llama.cpp for your system and make sure you do a CUDA build or the fastest option your system supports.</p>

            <pre>llama-cli -m models/llm-compiler-7b/ggml-model-f16.gguf -ngl 33 -f prompts/ir-to-asm.txt</pre>

            <p>We point the command to the converted model. We tell it to load all 33 layers onto the GPU (<span>-ngl</span>). If you don't know the number of layers you can give <span>-ngl</span> a big number (e.g. 50) and it will just load them all. Finally, we point it to a file containing our prompt.</p>

            <pre>
<div style="white-space:pre;font-family:Consolas;color:#d8dee9;-moz-tab-size:2;tab-size:2;">[INST] Give the x86-<span style="color:#f9ae58;">64</span> assembly for the following code when optimized using opt -p 'O0':<br><br>&lt;code><br><span style="color:#a6acb9;">; </span><span style="color:#a6acb9;">ModuleID </span><span style="color:#a6acb9;">= </span><span style="color:#a6acb9;">'consume_line.bc'</span><br>source_filename = <span style="color:#99c794;">"</span><span style="color:#99c794;">main.c</span><span style="color:#99c794;">"</span><br><span style="color:#ec5f66;">target</span> <span style="color:#ec5f66;">datalayout</span> = <span style="color:#99c794;">"</span><span style="color:#99c794;">e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-i128:128-f80:128-n8:16:32:64-S128</span><span style="color:#99c794;">"</span><br><span style="color:#ec5f66;">target</span> <span style="color:#ec5f66;">triple</span> = <span style="color:#99c794;">"</span><span style="color:#99c794;">x86_64-pc-linux-gnu</span><span style="color:#99c794;">"</span><br><br><span style="color:#a6acb9;">; </span><span style="color:#a6acb9;">Function </span><span style="color:#a6acb9;">Attrs: </span><span style="color:#a6acb9;">noinline </span><span style="color:#a6acb9;">nounwind </span><span style="color:#a6acb9;">uwtable</span><br><span style="color:#ec5f66;">define</span> dso_local <span style="color:#c695c6;font-style:italic;">i64</span> <span style="color:#ec5f66;font-style:italic;">@consume_line</span>(<span style="color:#c695c6;font-style:italic;">ptr</span> noundef <span style="color:#ec5f66;font-style:italic;">%0</span>, <span style="color:#c695c6;font-style:italic;">i64</span> noundef <span style="color:#ec5f66;font-style:italic;">%1</span>, <span style="color:#c695c6;font-style:italic;">i64</span> noundef <span style="color:#ec5f66;font-style:italic;">%2</span>) #<span style="color:#f9ae58;">0</span> {<br>  <span style="color:#ec5f66;font-style:italic;">%4</span> = <span style="color:#c695c6;">alloca</span> <span style="color:#c695c6;font-style:italic;">ptr</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#ec5f66;font-style:italic;">%5</span> = <span style="color:#c695c6;">alloca</span> <span style="color:#c695c6;font-style:italic;">i64</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#ec5f66;font-style:italic;">%6</span> = <span style="color:#c695c6;">alloca</span> <span style="color:#c695c6;font-style:italic;">i64</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#c695c6;">store</span> <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%0</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%4</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#c695c6;">store</span> <span style="color:#c695c6;font-style:italic;">i64</span> <span style="color:#ec5f66;font-style:italic;">%1</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%5</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#c695c6;">store</span> <span style="color:#c695c6;font-style:italic;">i64</span> <span style="color:#ec5f66;font-style:italic;">%2</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%6</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#c695c6;">br</span> <span style="color:#c695c6;font-style:italic;">label</span> <span style="color:#ec5f66;font-style:italic;">%7</span><br><br><span style="color:#f9ae58;">7</span>:                                                <span style="color:#a6acb9;">; </span><span style="color:#a6acb9;">preds </span><span style="color:#a6acb9;">= </span><span style="color:#a6acb9;">%20, </span><span style="color:#a6acb9;">%3</span><br>  <span style="color:#ec5f66;font-style:italic;">%8</span> = <span style="color:#c695c6;">load</span> <span style="color:#c695c6;font-style:italic;">i64</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%6</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#ec5f66;font-style:italic;">%9</span> = <span style="color:#c695c6;">load</span> <span style="color:#c695c6;font-style:italic;">i64</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%5</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#ec5f66;font-style:italic;">%10</span> = <span style="color:#c695c6;">icmp</span> <span style="color:#c695c6;">ult</span> <span style="color:#c695c6;font-style:italic;">i64</span> <span style="color:#ec5f66;font-style:italic;">%8</span>, <span style="color:#ec5f66;font-style:italic;">%9</span><br>  <span style="color:#c695c6;">br</span> <span style="color:#c695c6;font-style:italic;">i1</span> <span style="color:#ec5f66;font-style:italic;">%10</span>, <span style="color:#c695c6;font-style:italic;">label</span> <span style="color:#ec5f66;font-style:italic;">%11</span>, <span style="color:#c695c6;font-style:italic;">label</span> <span style="color:#ec5f66;font-style:italic;">%18</span><br><br><span style="color:#f9ae58;">11</span>:                                               <span style="color:#a6acb9;">; </span><span style="color:#a6acb9;">preds </span><span style="color:#a6acb9;">= </span><span style="color:#a6acb9;">%7</span><br>  <span style="color:#ec5f66;font-style:italic;">%12</span> = <span style="color:#c695c6;">load</span> <span style="color:#c695c6;font-style:italic;">ptr</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%4</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#ec5f66;font-style:italic;">%13</span> = <span style="color:#c695c6;">load</span> <span style="color:#c695c6;font-style:italic;">i64</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%6</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#ec5f66;font-style:italic;">%14</span> = <span style="color:#c695c6;">getelementptr</span> <span style="color:#c695c6;">inbounds</span> <span style="color:#c695c6;font-style:italic;">i8</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%12</span>, <span style="color:#c695c6;font-style:italic;">i64</span> <span style="color:#ec5f66;font-style:italic;">%13</span><br>  <span style="color:#ec5f66;font-style:italic;">%15</span> = <span style="color:#c695c6;">load</span> <span style="color:#c695c6;font-style:italic;">i8</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%14</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">1</span><br>  <span style="color:#ec5f66;font-style:italic;">%16</span> = <span style="color:#c695c6;">sext</span> <span style="color:#c695c6;font-style:italic;">i8</span> <span style="color:#ec5f66;font-style:italic;">%15</span> <span style="color:#c695c6;">to</span> <span style="color:#c695c6;font-style:italic;">i32</span><br>  <span style="color:#ec5f66;font-style:italic;">%17</span> = <span style="color:#c695c6;">icmp</span> <span style="color:#c695c6;">ne</span> <span style="color:#c695c6;font-style:italic;">i32</span> <span style="color:#ec5f66;font-style:italic;">%16</span>, <span style="color:#f9ae58;">10</span><br>  <span style="color:#c695c6;">br</span> <span style="color:#c695c6;font-style:italic;">label</span> <span style="color:#ec5f66;font-style:italic;">%18</span><br><br><span style="color:#f9ae58;">18</span>:                                               <span style="color:#a6acb9;">; </span><span style="color:#a6acb9;">preds </span><span style="color:#a6acb9;">= </span><span style="color:#a6acb9;">%11, </span><span style="color:#a6acb9;">%7</span><br>  <span style="color:#ec5f66;font-style:italic;">%19</span> = <span style="color:#c695c6;">phi</span> <span style="color:#c695c6;font-style:italic;">i1</span> [ <span style="color:#ec5f66;">false</span>, <span style="color:#ec5f66;font-style:italic;">%7</span> ], [ <span style="color:#ec5f66;font-style:italic;">%17</span>, <span style="color:#ec5f66;font-style:italic;">%11</span> ]<br>  <span style="color:#c695c6;">br</span> <span style="color:#c695c6;font-style:italic;">i1</span> <span style="color:#ec5f66;font-style:italic;">%19</span>, <span style="color:#c695c6;font-style:italic;">label</span> <span style="color:#ec5f66;font-style:italic;">%20</span>, <span style="color:#c695c6;font-style:italic;">label</span> <span style="color:#ec5f66;font-style:italic;">%23</span><br><br><span style="color:#f9ae58;">20</span>:                                               <span style="color:#a6acb9;">; </span><span style="color:#a6acb9;">preds </span><span style="color:#a6acb9;">= </span><span style="color:#a6acb9;">%18</span><br>  <span style="color:#ec5f66;font-style:italic;">%21</span> = <span style="color:#c695c6;">load</span> <span style="color:#c695c6;font-style:italic;">i64</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%6</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#ec5f66;font-style:italic;">%22</span> = <span style="color:#c695c6;">add</span> <span style="color:#c695c6;font-style:italic;">i64</span> <span style="color:#ec5f66;font-style:italic;">%21</span>, <span style="color:#f9ae58;">1</span><br>  <span style="color:#c695c6;">store</span> <span style="color:#c695c6;font-style:italic;">i64</span> <span style="color:#ec5f66;font-style:italic;">%22</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%6</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#c695c6;">br</span> <span style="color:#c695c6;font-style:italic;">label</span> <span style="color:#ec5f66;font-style:italic;">%7</span>, !llvm.loop !6<br><br><span style="color:#f9ae58;">23</span>:                                               <span style="color:#a6acb9;">; </span><span style="color:#a6acb9;">preds </span><span style="color:#a6acb9;">= </span><span style="color:#a6acb9;">%18</span><br>  <span style="color:#ec5f66;font-style:italic;">%24</span> = <span style="color:#c695c6;">load</span> <span style="color:#c695c6;font-style:italic;">i64</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%6</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#ec5f66;font-style:italic;">%25</span> = <span style="color:#c695c6;">add</span> <span style="color:#c695c6;font-style:italic;">i64</span> <span style="color:#ec5f66;font-style:italic;">%24</span>, <span style="color:#f9ae58;">1</span><br>  <span style="color:#c695c6;">store</span> <span style="color:#c695c6;font-style:italic;">i64</span> <span style="color:#ec5f66;font-style:italic;">%25</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%6</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#ec5f66;font-style:italic;">%26</span> = <span style="color:#c695c6;">load</span> <span style="color:#c695c6;font-style:italic;">i64</span>, <span style="color:#c695c6;font-style:italic;">ptr</span> <span style="color:#ec5f66;font-style:italic;">%6</span>, <span style="color:#ec5f66;">align</span> <span style="color:#f9ae58;">8</span><br>  <span style="color:#c695c6;">ret</span> <span style="color:#c695c6;font-style:italic;">i64</span> <span style="color:#ec5f66;font-style:italic;">%26</span><br>}<br><br><span style="color:#ec5f66;">attributes</span> #<span style="color:#f9ae58;">0</span> = { <br>  <span style="color:#ec5f66;">noinline</span> <span style="color:#ec5f66;">nounwind</span> <span style="color:#ec5f66;">uwtable</span> <br>  <span style="color:#99c794;">"</span><span style="color:#99c794;">frame-pointer</span><span style="color:#99c794;">"</span>=<span style="color:#99c794;">"</span><span style="color:#99c794;">all</span><span style="color:#99c794;">"</span> <br>  <span style="color:#99c794;">"</span><span style="color:#99c794;">min-legal-vector-width</span><span style="color:#99c794;">"</span>=<span style="color:#99c794;">"</span><span style="color:#99c794;">0</span><span style="color:#99c794;">"</span> <br>  <span style="color:#99c794;">"</span><span style="color:#99c794;">no-trapping-math</span><span style="color:#99c794;">"</span>=<span style="color:#99c794;">"</span><span style="color:#99c794;">true</span><span style="color:#99c794;">"</span> <br>  <span style="color:#99c794;">"</span><span style="color:#99c794;">stack-protector-buffer-size</span><span style="color:#99c794;">"</span>=<span style="color:#99c794;">"</span><span style="color:#99c794;">8</span><span style="color:#99c794;">"</span> <br>  <span style="color:#99c794;">"</span><span style="color:#99c794;">target-cpu</span><span style="color:#99c794;">"</span>=<span style="color:#99c794;">"</span><span style="color:#99c794;">x86-64</span><span style="color:#99c794;">"</span> <br>  <span style="color:#99c794;">"</span><span style="color:#99c794;">target-features</span><span style="color:#99c794;">"</span>=<span style="color:#99c794;">"</span><span style="color:#99c794;">+cmov,+cx8,+fxsr,+mmx,+sse,+sse2,+x87</span><span style="color:#99c794;">"</span> <br>  <span style="color:#99c794;">"</span><span style="color:#99c794;">tune-cpu</span><span style="color:#99c794;">"</span>=<span style="color:#99c794;">"</span><span style="color:#99c794;">generic</span><span style="color:#99c794;">"</span> <br>}<br><br>!llvm.module.flags = !{!0, !1, !2, !3, !4}<br>!llvm.ident = !{!5}<br><br>!0 = !{<span style="color:#c695c6;font-style:italic;">i32</span> <span style="color:#f9ae58;">1</span>, !<span style="color:#99c794;">"</span><span style="color:#99c794;">wchar_size</span><span style="color:#99c794;">"</span>, <span style="color:#c695c6;font-style:italic;">i32</span> <span style="color:#f9ae58;">4</span>}<br>!1 = !{<span style="color:#c695c6;font-style:italic;">i32</span> <span style="color:#f9ae58;">8</span>, !<span style="color:#99c794;">"</span><span style="color:#99c794;">PIC </span><span style="color:#99c794;">Level</span><span style="color:#99c794;">"</span>, <span style="color:#c695c6;font-style:italic;">i32</span> <span style="color:#f9ae58;">2</span>}<br>!2 = !{<span style="color:#c695c6;font-style:italic;">i32</span> <span style="color:#f9ae58;">7</span>, !<span style="color:#99c794;">"</span><span style="color:#99c794;">PIE </span><span style="color:#99c794;">Level</span><span style="color:#99c794;">"</span>, <span style="color:#c695c6;font-style:italic;">i32</span> <span style="color:#f9ae58;">2</span>}<br>!3 = !{<span style="color:#c695c6;font-style:italic;">i32</span> <span style="color:#f9ae58;">7</span>, !<span style="color:#99c794;">"</span><span style="color:#99c794;">uwtable</span><span style="color:#99c794;">"</span>, <span style="color:#c695c6;font-style:italic;">i32</span> <span style="color:#f9ae58;">2</span>}<br>!4 = !{<span style="color:#c695c6;font-style:italic;">i32</span> <span style="color:#f9ae58;">7</span>, !<span style="color:#99c794;">"</span><span style="color:#99c794;">frame-pointer</span><span style="color:#99c794;">"</span>, <span style="color:#c695c6;font-style:italic;">i32</span> <span style="color:#f9ae58;">2</span>}<br>!5 = !{!<span style="color:#99c794;">"</span><span style="color:#99c794;">Ubuntu </span><span style="color:#99c794;">clang </span><span style="color:#99c794;">version </span><span style="color:#99c794;">18.1.8 </span><span style="color:#99c794;">(++20240615103753+3b5b5c1ec4a3-1~exp1~20240615223858.136)</span><span style="color:#99c794;">"</span>}<br>!6 = distinct !{!6, !7}<br>!7 = !{!<span style="color:#99c794;">"</span><span style="color:#99c794;">llvm.loop.mustprogress</span><span style="color:#99c794;">"</span>}<br><br>&lt;/code><br><br>The input code has instruction count <span style="color:#f9ae58;">29</span> <span style="color:#c695c6;">and</span> binary size <span style="color:#f9ae58;">129</span> bytes. [/INST] <br><br>The assembly will have instruction count <span style="color:#f9ae58;">29</span> <span style="color:#c695c6;">and</span> binary sise <span style="color:#f9ae58;">129</span> bytes:<br><br>&lt;code>  .text<br>  .file <span style="color:#99c794;">"</span><span style="color:#99c794;">-</span><span style="color:#99c794;">"</span><br>  .globl  consume_line                    # -- Begin function consume_line<br>  .<span style="color:#ec5f66;">type</span> consume_line,<span style="color:#ec5f66;font-style:italic;">@function</span><br>consume_line:                           # <span style="color:#ec5f66;font-style:italic;">@consume_line</span><br>  .cfi_startproc<br># <span style="color:#ec5f66;font-style:italic;">%bb.0</span>:<br>  movq  <span style="color:#ec5f66;font-style:italic;">%rdi</span>, -<span style="color:#f9ae58;">8</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>)<br>  movq  <span style="color:#ec5f66;font-style:italic;">%rsi</span>, -<span style="color:#f9ae58;">16</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>)<br>  movq  <span style="color:#ec5f66;font-style:italic;">%rdx</span>, -<span style="color:#f9ae58;">24</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>)<br>.LBB0_1:                                # =>This Inner Loop Header: Depth=<span style="color:#f9ae58;">1</span><br>  movq  -<span style="color:#f9ae58;">24</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>), <span style="color:#ec5f66;font-style:italic;">%rcx</span><br>  xorl  <span style="color:#ec5f66;font-style:italic;">%eax</span>, <span style="color:#ec5f66;font-style:italic;">%eax</span><br>                                        # kill: def $al killed $al killed $eax<br>  cmpq  -<span style="color:#f9ae58;">16</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>), <span style="color:#ec5f66;font-style:italic;">%rcx</span><br>  movb  <span style="color:#ec5f66;font-style:italic;">%al</span>, -<span style="color:#f9ae58;">25</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>)                  # <span style="color:#f9ae58;">1</span>-byte Spill<br>  jae .LBB0_3<br># <span style="color:#ec5f66;font-style:italic;">%bb.2</span>:                                #   in Loop: Header=BB0_1 Depth=<span style="color:#f9ae58;">1</span><br>  movq  -<span style="color:#f9ae58;">8</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>), <span style="color:#ec5f66;font-style:italic;">%rax</span><br>  movq  -<span style="color:#f9ae58;">24</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>), <span style="color:#ec5f66;font-style:italic;">%rcx</span><br>  movsbl  (<span style="color:#ec5f66;font-style:italic;">%rax</span>,<span style="color:#ec5f66;font-style:italic;">%rcx</span>), <span style="color:#ec5f66;font-style:italic;">%eax</span><br>  cmpl  $<span style="color:#f9ae58;">10</span>, <span style="color:#ec5f66;font-style:italic;">%eax</span><br>  setne <span style="color:#ec5f66;font-style:italic;">%al</span><br>  movb  <span style="color:#ec5f66;font-style:italic;">%al</span>, -<span style="color:#f9ae58;">25</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>)                  # <span style="color:#f9ae58;">1</span>-byte Spill<br>.LBB0_3:                                #   in Loop: Header=BB0_1 Depth=<span style="color:#f9ae58;">1</span><br>  movb  -<span style="color:#f9ae58;">25</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>), <span style="color:#ec5f66;font-style:italic;">%al</span>                  # <span style="color:#f9ae58;">1</span>-byte Reload<br>  testb $<span style="color:#f9ae58;">1</span>, <span style="color:#ec5f66;font-style:italic;">%al</span><br>  jne .LBB0_4<br>  jmp .LBB0_5<br>.LBB0_4:                                #   in Loop: Header=BB0_1 Depth=<span style="color:#f9ae58;">1</span><br>  movq  -<span style="color:#f9ae58;">24</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>), <span style="color:#ec5f66;font-style:italic;">%rax</span><br>  addq  $<span style="color:#f9ae58;">1</span>, <span style="color:#ec5f66;font-style:italic;">%rax</span><br>  movq  <span style="color:#ec5f66;font-style:italic;">%rax</span>, -<span style="color:#f9ae58;">24</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>)<br>  jmp .LBB0_1<br>.LBB0_5:<br>  movq  -<span style="color:#f9ae58;">24</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>), <span style="color:#ec5f66;font-style:italic;">%rax</span><br>  addq  $<span style="color:#f9ae58;">1</span>, <span style="color:#ec5f66;font-style:italic;">%rax</span><br>  movq  <span style="color:#ec5f66;font-style:italic;">%rax</span>, -<span style="color:#f9ae58;">24</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>)<br>  movq  -<span style="color:#f9ae58;">24</span>(<span style="color:#ec5f66;font-style:italic;">%rsp</span>), <span style="color:#ec5f66;font-style:italic;">%rax</span><br>  retq<br>.Lfunc_end0:<br>  .size consume_line, .Lfunc_end0-consume_line<br>  .cfi_endproc<br>                                        # -- End function<br>  .ident  <span style="color:#99c794;">"</span><span style="color:#99c794;">clang </span><span style="color:#99c794;">version </span><span style="color:#99c794;">17.0.6 </span><span style="color:#99c794;">(</span><span style="color:#99c794;">git@github.com:fairinternal</span><span style="color:#99c794;">/</span><span style="color:#99c794;">CodeGen.git </span><span style="color:#99c794;">b05db9bbf7a92019267416c1bb9996fe6134e3f1)</span><span style="color:#99c794;">"</span><br>  .<span style="color:#ec5f66;">section</span>  <span style="color:#99c794;">"</span><span style="color:#99c794;">.note.GNU-stack</span><span style="color:#99c794;">"</span>,<span style="color:#99c794;">"</span><span style="color:#99c794;">"</span>,<span style="color:#ec5f66;font-style:italic;">@progbits</span><br>  .addrsig<br>&lt;/code></div>
            </pre>

            <p>Note: You can run llama.cpp as a server and there are scripts to make it OpenAI API compatible if you are looking to do inference from your code.</p>
        </div>

        <div>
            <h2>Evaluation</h2>

            <p></p>
        </div>

        <div>
            <h2>Results</h2>

            <h3>Consume Line</h3>
            <h3>Copy 64 Hex</h3>
            <h3>Validate</h3>
            <h3>Parse Diff</h3>
        </div>

    </body>
</html>

